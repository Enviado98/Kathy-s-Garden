<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Gossip Club 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --bg: #eef1f5;
            --purple: #6200ea;
            --black: #212121;
            --orange: #ff6d00;
            --yellow: #ffd600;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: var(--bg);
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            touch-action: none;
            user-select: none;
            cursor: pointer;
        }

        /* ESCENARIO 3D */
        .scene {
            position: relative;
            width: 300px;
            height: 300px;
            perspective: 1000px; /* Clave para el efecto de giro */
        }

        .group {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        /* --- PERSONAJE BASE --- */
        .char {
            position: absolute;
            bottom: 0;
            transform-style: preserve-3d; /* Permite que tengan volumen plano */
            will-change: transform;
        }

        .body {
            position: relative;
            width: 100%;
            height: 100%;
            transform-origin: center center;
            backface-visibility: visible; /* Importante para verlos dar la vuelta */
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        /* CARA (Solo visible por el frente) */
        .face {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            backface-visibility: hidden; /* DESAPARECE si nos da la espalda */
            z-index: 2;
        }

        /* ESPALDA (Simulada para cuando giran) */
        .back-side {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: inherit;
            border-radius: inherit;
            transform: rotateY(180deg); /* Est치 pegada atr치s */
            backface-visibility: hidden;
            z-index: 1;
        }
        
        /* Detalles de la espalda (opcional, una costura o nada) */
        .back-seam {
            position: absolute;
            top: 20%; left: 50%;
            width: 2px; height: 60%;
            background: rgba(0,0,0,0.1);
            transform: translateX(-50%);
        }

        /* OJOS */
        .eye-socket {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .pupil {
            width: 40%; height: 40%;
            background: #000;
            border-radius: 50%;
            position: absolute;
        }

        .eyelid {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 0%;
            background: inherit; /* P치rpado del color de piel */
            z-index: 10;
        }

        .mouth {
            position: absolute;
            background: #222;
            border-radius: 5px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* --- CONFIGURACI칍N INDIVIDUAL --- */
        
        /* 1. MORADO (Alto, Lider, DE ESPALDAS AL INICIO) */
        #c-purple {
            left: 40px; bottom: 80px; width: 100px; height: 200px;
            z-index: 50; /* Atr치s en Z pero visible */
        }
        #c-purple .body { background: var(--purple); border-radius: 12px; }
        #c-purple .eye-socket { width: 20px; height: 20px; top: 60px; }
        #c-purple .mouth { width: 20px; height: 4px; top: 95px; }

        /* 2. NEGRO (Medio, Hater, DE ESPALDAS AL INICIO) */
        #c-black {
            left: 150px; bottom: 70px; width: 90px; height: 170px;
            z-index: 60;
        }
        #c-black .body { background: var(--black); border-radius: 8px; }
        #c-black .eye-socket { width: 18px; height: 18px; top: 50px; background: white; }
        #c-black .mouth { width: 15px; height: 2px; top: 80px; background: #888; }

        /* 3. NARANJA (Gordo, Tonto, DE PERFIL AL INICIO) */
        #c-orange {
            left: 0px; bottom: 0px; width: 140px; height: 110px;
            z-index: 100;
        }
        #c-orange .body { background: var(--orange); border-radius: 70px 70px 20px 20px; }
        #c-orange .eye-socket { width: 16px; height: 16px; top: 40px; }
        #c-orange .mouth { width: 30px; height: 10px; top: 65px; border-radius: 0 0 30px 30px; }

        /* 4. AMARILLO (Peque침o, Nervioso, DE FRENTE/PERFIL) */
        #c-yellow {
            left: 180px; bottom: 0px; width: 90px; height: 130px;
            z-index: 110;
        }
        #c-yellow .body { background: var(--yellow); border-radius: 45px 45px 0 0; }
        #c-yellow .eye-socket { width: 14px; height: 14px; top: 45px; }
        #c-yellow .mouth { width: 10px; height: 3px; top: 70px; }

        /* Globos de texto sutiles */
        .rumor {
            position: absolute;
            top: -20px; left: 50%;
            font-size: 20px;
            opacity: 0;
            pointer-events: none;
        }

    </style>
</head>
<body>

<div class="scene">
    <div class="group" id="group">
        <!-- Generado por JS para control total -->
    </div>
</div>

<script>
/**
 * MOTOR DE VIDA "THE GOSSIP CLUB"
 * Enfoque: Asincron칤a total, f칤sica de rotaci칩n y comportamiento pasivo-agresivo.
 */

// --- CONFIGURACI칍N DE PERSONAJES ---
const CHAR_DATA = [
    { 
        id: 'c-purple', 
        color: '#6200ea', 
        startAngle: 170, // Casi de espaldas completo
        role: 'leader',
        eyeSep: 30
    },
    { 
        id: 'c-black', 
        color: '#212121', 
        startAngle: 190, // De espaldas hacia el otro lado
        role: 'hater',
        eyeSep: 25
    },
    { 
        id: 'c-orange', 
        color: '#ff6d00', 
        startAngle: 45, // Mirando al centro
        role: 'dumb',
        eyeSep: 40
    },
    { 
        id: 'c-yellow', 
        color: '#ffd600', 
        startAngle: -45, // Mirando al centro (conversando con naranja)
        role: 'nervous',
        eyeSep: 20
    }
];

class Character {
    constructor(data, container) {
        this.data = data;
        this.currentAngle = data.startAngle; // 츼ngulo actual del cuerpo
        this.targetAngle = data.startAngle;
        this.isSuspicious = false;
        this.attention = { x: 0, y: 0 }; // A d칩nde miran los ojos

        this.el = this.createDOM(container);
        this.bodyEl = this.el.querySelector('.body');
        this.eyes = this.el.querySelectorAll('.eye-socket');
        this.pupils = this.el.querySelectorAll('.pupil');
        this.eyelids = this.el.querySelectorAll('.eyelid');
        this.mouth = this.el.querySelector('.mouth');

        // Inicializar rotaci칩n
        gsap.set(this.el, { rotationY: this.currentAngle });

        // Ciclos de vida independientes
        this.startBreathing();
        this.startBlinking();
        
        // Asignar comportamiento de toque
        this.el.addEventListener('pointerdown', (e) => {
            e.stopPropagation();
            Director.handleCharTouch(this);
        });
    }

    createDOM(container) {
        const div = document.createElement('div');
        div.className = 'char';
        div.id = this.data.id;
        
        // HTML Structure
        div.innerHTML = `
            <div class="body">
                <div class="rumor">游눫</div>
                <!-- Cara Frontal -->
                <div class="face">
                    <div class="eye-socket" style="left: 50%; margin-left: -${this.data.eyeSep/2 + 10}px">
                        <div class="pupil"></div><div class="eyelid"></div>
                    </div>
                    <div class="eye-socket" style="left: 50%; margin-left: ${this.data.eyeSep/2 - 10}px">
                        <div class="pupil"></div><div class="eyelid"></div>
                    </div>
                    <div class="mouth"></div>
                </div>
                <!-- Cara Trasera -->
                <div class="back-side">
                    <div class="back-seam"></div>
                </div>
            </div>
        `;
        container.appendChild(div);
        return div;
    }

    // --- ACCIONES F칈SICAS ---

    // El giro lento y dram치tico
    turnBodyTo(angle, speed = 1, delay = 0) {
        this.targetAngle = angle;
        
        gsap.to(this.el, {
            rotationY: angle,
            duration: speed,
            delay: delay,
            ease: "power2.inOut", // Inercia pesada
            onUpdate: () => {
                this.currentAngle = gsap.getProperty(this.el, "rotationY");
            }
        });
    }

    lookAt(x, y) {
        // x, y son coordenadas relativas (-1 a 1)
        // Movemos las pupilas dentro de los ojos
        const range = 5; 
        gsap.to(this.pupils, {
            x: x * range,
            y: y * range,
            duration: 0.5
        });
    }

    setExpression(type) {
        gsap.killTweensOf(this.eyelids);
        gsap.killTweensOf(this.mouth);

        if (type === 'suspicious') {
            // Ojos entrecerrados
            gsap.to(this.eyelids, { height: '40%', duration: 0.5 });
            gsap.to(this.mouth, { width: 10, height: 2, borderRadius: 0, duration: 0.5 });
        } else if (type === 'hate') {
            // Muy cerrados
            gsap.to(this.eyelids, { height: '60%', duration: 0.2 });
            gsap.to(this.mouth, { width: 15, height: 2, rotation: 5, duration: 0.3 });
        } else if (type === 'shock') {
            // Abiertos
            gsap.to(this.eyelids, { height: '0%', duration: 0.1 });
            gsap.to(this.mouth, { width: 10, height: 10, borderRadius: '50%', duration: 0.1 });
        } else {
            // Normal
            gsap.to(this.eyelids, { height: '0%', duration: 0.5 });
            const w = this.data.id === 'c-orange' ? 30 : 15;
            const h = this.data.id === 'c-orange' ? 10 : (this.data.id === 'c-purple' ? 4 : 2);
            gsap.to(this.mouth, { width: w, height: h, borderRadius: '0 0 10px 10px', rotation: 0, duration: 0.5 });
        }
    }

    talk() {
        if(this.isTalking) return;
        this.isTalking = true;
        
        // Animaci칩n de chisme (vibraci칩n y boca)
        this.talkTween = gsap.to(this.mouth, {
            width: "+=5", height: "+=4",
            repeat: -1, yoyo: true, duration: 0.15
        });
        
        // Cuerpo vibra sutilmente
        this.bodyTween = gsap.to(this.el, {
            rotationZ: () => (Math.random() - 0.5) * 3,
            repeat: -1, yoyo: true, duration: 0.2
        });

        // Emoji
        const rumor = this.el.querySelector('.rumor');
        gsap.to(rumor, { y: -30, opacity: 1, duration: 0.5, onComplete: () => {
            gsap.to(rumor, { opacity: 0, delay: 0.5 });
            gsap.set(rumor, { y: -20, delay: 1 });
        }});
    }

    stopTalking() {
        this.isTalking = false;
        if(this.talkTween) this.talkTween.kill();
        if(this.bodyTween) this.bodyTween.kill();
        gsap.to(this.el, { rotationZ: 0, duration: 0.5 });
        this.setExpression('neutral');
    }

    // --- CICLOS DE VIDA ---
    startBreathing() {
        gsap.to(this.bodyEl, {
            scaleY: 1.01, scaleX: 0.99, y: 1,
            duration: 1.5 + Math.random(),
            repeat: -1, yoyo: true, ease: "sine.inOut",
            delay: Math.random() * 2 // Desfase
        });
    }

    startBlinking() {
        const blink = () => {
            if(!this.isSuspicious) { // No parpadear si te miran fijo con odio
                gsap.to(this.eyelids, { height: '100%', duration: 0.1, yoyo: true, repeat: 1 });
            }
            setTimeout(blink, Math.random() * 4000 + 2000);
        };
        setTimeout(blink, Math.random() * 3000);
    }
}

// --- DIRECTOR (IA GLOBAL) ---
const Director = {
    chars: [],
    state: 'GOSSIP', // GOSSIP, SUSPICION, CONFRONTATION
    annoyanceLevel: 0,
    timer: null,

    init() {
        const container = document.getElementById('group');
        CHAR_DATA.forEach(data => {
            this.chars.push(new Character(data, container));
        });

        // Evento global (toque en fondo)
        document.body.addEventListener('pointerdown', (e) => {
            if(!e.target.closest('.char')) {
                this.handleGlobalDisturbance();
            }
        });

        this.startGossipLoop();
    },

    startGossipLoop() {
        const loop = () => {
            if (this.state !== 'GOSSIP') return;

            // Reiniciar
            this.chars.forEach(c => c.stopTalking());

            // 1. Qui칠n habla? (Probabilidad)
            const speaker = this.chars[Math.floor(Math.random() * this.chars.length)];
            
            // Si est치 de espaldas, no puede hablar (regla f칤sica), a menos que se gire un poco
            if (Math.abs(speaker.currentAngle) > 90) {
                // Habla susurrando de espaldas (vibraci칩n)
                gsap.to(speaker.el, { rotationZ: 2, repeat: 3, yoyo: true, duration: 0.1 });
            } else {
                speaker.talk();
            }

            // 2. Los dem치s reaccionan (sutil)
            this.chars.forEach(c => {
                if (c !== speaker) {
                    // Si est치n de frente, miran al speaker
                    if (Math.abs(c.currentAngle) < 90) {
                        // Calcular direcci칩n aproximada (izquierda o derecha)
                        const dir = speaker.data.id === 'c-purple' || speaker.data.id === 'c-orange' ? -1 : 1;
                        c.lookAt(dir * 0.5, 0);
                    }
                }
            });

            this.timer = setTimeout(loop, Math.random() * 2000 + 1500);
        };
        loop();
    },

    // --- L칍GICA DE INTERRUPCI칍N (LO QUE PEDISTE) ---
    
    handleGlobalDisturbance() {
        // Incrementa la molestia
        this.annoyanceLevel++;
        console.log("Molestia:", this.annoyanceLevel);

        clearTimeout(this.timer); // Cortar chisme

        // NIVEL 1: SOSPECHA (1-2 toques)
        // Solo uno gira un poco la cabeza (no el cuerpo entero), mirada de reojo
        if (this.annoyanceLevel <= 2) {
            const spy = this.chars.find(c => c.data.role === 'leader'); // El morado suele chequear
            
            // Detener habla
            this.chars.forEach(c => c.stopTalking());

            // El morado (que est치 de espaldas) gira levemente el cuerpo
            // De 170 a 140 (no te mira del todo, solo por encima del hombro)
            spy.turnBodyTo(140, 2, 0); 
            spy.lookAt(1, 0); // Ojos a la esquina extrema para verte
            spy.setExpression('suspicious');

            // Despu칠s vuelve a lo suyo
            setTimeout(() => {
                if(this.annoyanceLevel <= 2) this.recover();
            }, 3000);
        }
        
        // NIVEL 2: CONFRONTACI칍N LENTA (3+ toques)
        // Todos se giran lentamente para mirarte
        else {
            this.state = 'CONFRONTATION';
            this.chars.forEach(c => c.stopTalking());

            // LOGICA DE GIRO INDEPENDIENTE (No sincronizado)
            this.chars.forEach(c => {
                // C치lculo de delay basado en personalidad
                // El amarillo (nervioso) gira r치pido. El morado (l칤der) gira lento y pesado.
                let delay = Math.random() * 0.5;
                let speed = 2; // Lento por defecto

                if (c.data.role === 'leader') { delay = 0.8; speed = 3; } // Gira muy lento, intimidante
                if (c.data.role === 'nervous') { delay = 0; speed = 0.5; } // Gira asustado

                // Objetivo: Mirar a c치mara (츼ngulo 0)
                // PERO, si estaban de espaldas (180), tienen que recorrer mucho camino
                c.turnBodyTo(0, speed, delay);
                
                // Expresiones
                setTimeout(() => {
                    c.lookAt(0, 0); // Mirar fijo al centro
                    if (c.data.role === 'leader' || c.data.role === 'hater') {
                        c.setExpression('hate'); // Odio puro
                    } else {
                        c.setExpression('suspicious');
                    }
                }, (speed + delay) * 500); // Expresi칩n a mitad del giro
            });

            // Recuperaci칩n larga si dejas de molestar
            setTimeout(() => {
                this.annoyanceLevel = 0;
                this.recover();
            }, 6000);
        }
    },

    handleCharTouch(char) {
        // Si tocas a uno espec칤fico, rompe su personaje
        this.annoyanceLevel = 5; // Salta a confrontaci칩n
        
        // Reacci칩n inmediata del tocado
        char.setExpression('shock');
        gsap.to(char.el, { scale: 1.1, y: -10, duration: 0.1, yoyo: true, repeat: 1 });
        
        // Los dem치s miran al tocado, no a ti
        this.chars.forEach(c => {
            if (c !== char) {
                // Giran hacia el compa침ero tocado
                // Simplificaci칩n: miran al centro
                c.turnBodyTo(0, 1, Math.random() * 0.5);
                c.lookAt(char.data.id.includes('orange') ? -0.5 : 0.5, 0);
                c.setExpression('shock');
            }
        });

        setTimeout(() => this.recover(), 4000);
    },

    recover() {
        this.state = 'GOSSIP';
        this.chars.forEach(c => {
            // Vuelven a su posici칩n original
            // El delay ayuda a que no parezca coreograf칤a
            c.turnBodyTo(c.data.startAngle, 2, Math.random());
            c.setExpression('neutral');
            c.lookAt(0, 0);
        });
        setTimeout(() => this.startGossipLoop(), 2500);
    }
};

// Start
Director.init();

</script>
</body>
</html>
