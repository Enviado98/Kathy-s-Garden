<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Los Bichitos Chismosos</title>
    <style>
        :root {
            --bg-color: #e6e6ee;
            --purple: #6a00ff;
            --black: #1a1a1a;
            --orange: #ff7b25;
            --yellow: #fecb00;
        }

        body {
            background-color: var(--bg-color);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: sans-serif;
            cursor: pointer; /* Indica que se puede tocar */
        }

        /* --- STAGE --- */
        .stage {
            position: relative;
            width: 600px;
            height: 500px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        /* --- BASE CHARACTER STYLES --- */
        .bicho {
            position: absolute;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: bottom center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            cursor: grab;
        }

        .eyes {
            position: absolute;
            display: flex;
            justify-content: space-between;
            width: 60%;
            left: 20%;
            transition: all 0.2s ease-out;
        }

        .eye {
            background: white;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }

        .pupil {
            background: black;
            border-radius: 50%;
            position: absolute;
            transition: all 0.1s ease-out; /* Fast eye movement */
        }

        .mouth {
            position: absolute;
            background: black;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        /* --- INDIVIDUAL CHARACTERS --- */

        /* 1. EL LÍDER (Morado) - Alto, rectángulo */
        #purple {
            width: 140px;
            height: 280px;
            background-color: var(--purple);
            bottom: 100px; /* Detrás */
            left: 120px;
            z-index: 1;
            border-radius: 4px;
        }
        #purple .eyes { top: 60px; width: 50%; left: 25%; }
        #purple .eye { width: 18px; height: 18px; }
        #purple .pupil { width: 6px; height: 6px; top: 6px; left: 6px; }
        #purple .mouth { width: 20px; height: 4px; top: 90px; }

        /* 2. EL ABURRIDO (Negro) - Rectángulo medio */
        #black {
            width: 100px;
            height: 200px;
            background-color: var(--black);
            bottom: 100px;
            left: 280px;
            z-index: 2;
            border-radius: 4px;
        }
        #black .eyes { top: 80px; width: 60%; left: 20%; }
        #black .eye { width: 15px; height: 15px; background: white; }
        #black .pupil { width: 5px; height: 5px; top: 5px; left: 5px; }
        #black .mouth { width: 15px; height: 2px; top: 110px; background: white; opacity: 0.5; }

        /* 3. EL TÍMIDO (Amarillo) - Arco */
        #yellow {
            width: 110px;
            height: 160px;
            background-color: var(--yellow);
            bottom: 100px;
            left: 370px;
            z-index: 3;
            border-radius: 60px 60px 0 0;
        }
        #yellow .eyes { top: 50px; width: 40%; left: 40%; /* Mira de lado */ }
        #yellow .eye { width: 8px; height: 8px; background: black; } 
        #yellow .pupil { width: 3px; height: 3px; background: white; top: 1px; left: 2px;} /* Ojos invertidos */
        #yellow .mouth { width: 30px; height: 3px; top: 75px; left: 60%; }

        /* 4. EL TONTO (Naranja) - Semicírculo */
        #orange {
            width: 260px;
            height: 130px;
            background-color: var(--orange);
            bottom: 0;
            left: 50px;
            z-index: 4;
            border-radius: 130px 130px 0 0;
        }
        #orange .eyes { top: 50px; width: 40%; left: 30%; }
        #orange .eye { width: 12px; height: 6px; border-radius: 10px; background: #333; } /* Ojos cerrados/felices */
        #orange .pupil { display: none; }
        #orange .mouth { width: 20px; height: 10px; top: 70px; border-radius: 0 0 20px 20px; }

        /* --- CLASES DE ESTADO (ANIMACIONES) --- */

        /* Enojados / Interrumpidos */
        .angry-stare .bicho {
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
            transform: scale(1.05) translateY(0) !important; /* Reset bounces */
        }
        .angry-stare .eye {
            border-top: 5px solid var(--bg-color); /* Ceño fruncido hack */
            border-radius: 0;
        }
        .angry-stare #orange .eye {
            background: white; height: 15px; border-radius: 50%; border-top: 8px solid var(--orange);
        }

        /* Hablando */
        .talking .mouth {
            animation: talk 0.2s infinite alternate;
        }
        @keyframes talk {
            from { height: 4px; width: 20px; }
            to { height: 15px; width: 15px; border-radius: 50%; }
        }

        /* Saltito de Idea */
        @keyframes jump {
            0% { transform: translateY(0) scale(1,1); }
            40% { transform: translateY(-30px) scale(0.9, 1.1); }
            100% { transform: translateY(0) scale(1,1); }
        }
        .jumping { animation: jump 0.6s ease; }

        /* Temblor de Miedo/Timidez */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }
        .shaking { animation: shake 0.2s infinite; }

        /* Aburrido */
        .sleeping { transform: scaleY(0.95) translateY(5px); opacity: 0.9; }

        /* Mensaje flotante (debug/pensamiento) */
        #thought-bubble {
            position: absolute;
            top: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            font-size: 14px;
            color: #555;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

    </style>
</head>
<body>

    <div id="thought-bubble">...</div>

    <div class="stage" id="stage">
        <!-- 1. Purple (Leader) -->
        <div class="bicho" id="purple">
            <div class="eyes">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
            </div>
            <div class="mouth"></div>
        </div>

        <!-- 2. Black (Bored) -->
        <div class="bicho" id="black">
            <div class="eyes">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
            </div>
            <div class="mouth"></div>
        </div>

        <!-- 3. Yellow (Timid) -->
        <div class="bicho" id="yellow">
            <div class="eyes">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
            </div>
            <div class="mouth"></div>
        </div>

        <!-- 4. Orange (Dumb/Happy) -->
        <div class="bicho" id="orange">
            <div class="eyes">
                <div class="eye"></div> <!-- No pupils for this design style initially -->
                <div class="eye"></div>
            </div>
            <div class="mouth"></div>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN Y REFERENCIAS ---
        const stage = document.getElementById('stage');
        const bubble = document.getElementById('thought-bubble');
        const bichos = {
            purple: { el: document.getElementById('purple'), role: 'leader', baseScale: 1 },
            black: { el: document.getElementById('black'), role: 'bored', baseScale: 1 },
            yellow: { el: document.getElementById('yellow'), role: 'timid', baseScale: 1 },
            orange: { el: document.getElementById('orange'), role: 'dumb', baseScale: 1 }
        };

        let state = 'IDLE'; // IDLE, GOSSIPING, ANGRY, SCARED
        let mouseX = 0;
        let mouseY = 0;
        let interactionTimer = null;
        let lastInteractionTime = Date.now();

        // --- MOTOR DE PERSONALIDAD (BRAIN) ---
        
        // Función principal que corre cada cierto tiempo
        function brainLoop() {
            if (state === 'ANGRY') return; // Si están enojados, no piensan, solo juzgan.

            const now = Date.now();
            const timeSinceInteract = now - lastInteractionTime;
            const r = Math.random();

            // 1. Estados de Aburrimiento
            if (timeSinceInteract > 8000 && state !== 'SLEEPING') {
                if(r > 0.7) triggerEvent('boredom');
            }

            // 2. Eventos Aleatorios (Gossip, Ideas, Miradas)
            if (state === 'IDLE' || state === 'GOSSIPING') {
                if (r < 0.02) triggerEvent('idea'); // Alguien tiene una idea
                else if (r < 0.05) triggerEvent('lookAtUser'); // Romper la cuarta pared
                else if (r < 0.15) triggerEvent('changeGossip'); // Cambiar quién habla
                else if (r < 0.3) triggerEvent('idleMovement'); // Movimiento natural
            }

            // Loop recursivo con tiempo variable para naturalidad
            setTimeout(brainLoop, 500 + Math.random() * 1000);
        }

        // --- SISTEMA DE EVENTOS ---

        function triggerEvent(type) {
            resetStyles();

            switch(type) {
                case 'gossip':
                case 'changeGossip':
                    state = 'GOSSIPING';
                    const speakers = ['purple', 'orange']; // Los más habladores
                    const listeners = ['black', 'yellow'];
                    
                    const speakerKey = speakers[Math.floor(Math.random() * speakers.length)];
                    const speaker = bichos[speakerKey];
                    
                    // El que habla
                    speaker.el.classList.add('talking');
                    
                    // Los demás miran al que habla
                    Object.keys(bichos).forEach(k => {
                        if(k !== speakerKey) {
                            lookAtElement(bichos[k], speaker.el);
                        }
                    });
                    break;

                case 'lookAtUser':
                    // Uno sospecha y mira a la cámara
                    const suspectKey = Math.random() > 0.5 ? 'yellow' : 'black'; // El tímido o el aburrido suelen mirar
                    moveEyesTo(bichos[suspectKey], window.innerWidth/2, window.innerHeight * 2); // Mirar "hacia afuera"
                    break;

                case 'idea':
                    const smartOne = bichos['purple'];
                    smartOne.el.classList.add('jumping');
                    setTimeout(() => smartOne.el.classList.remove('jumping'), 1000);
                    // Los otros miran sorprendidos hacia arriba
                    Object.values(bichos).forEach(b => {
                        if(b !== smartOne) lookAtElement(b, smartOne.el, -50);
                    });
                    break;

                case 'boredom':
                    state = 'IDLE';
                    bichos['black'].el.classList.add('sleeping');
                    bichos['orange'].el.style.transform = "rotate(5deg)"; // Se distrae
                    break;
                
                case 'idleMovement':
                    // Pequeños rebotes o respiración
                    Object.values(bichos).forEach(b => {
                        const shift = (Math.random() - 0.5) * 10;
                        const scale = 1 + (Math.random() * 0.02);
                        b.el.style.transform = `translateY(${shift}px) scale(${scale})`;
                    });
                    break;
            }
        }

        // --- INTERACCIÓN DEL USUARIO (TOUCH/CLICK) ---

        // 1. Interrupción Global (Click en el fondo)
        document.body.addEventListener('click', (e) => {
            if (e.target.closest('.bicho')) return; // Si tocas un bicho es otra lógica

            handleInterruption();
        });

        // 2. Tocar a un bicho específico
        Object.keys(bichos).forEach(key => {
            bichos[key].el.addEventListener('click', (e) => {
                e.stopPropagation();
                pokeBicho(key);
            });
        });

        // Lógica de "Me molestaste"
        function handleInterruption() {
            state = 'ANGRY';
            lastInteractionTime = Date.now();
            resetStyles();
            document.body.classList.add('angry-stare');

            // Todos giran lentamente a mirar al frente (usuario)
            Object.values(bichos).forEach(b => {
                b.el.style.transform = 'translate(0,0) scale(1.05)'; // Se ponen firmes
                
                // Ojos clavados en el centro de la pantalla
                const eyes = b.el.querySelectorAll('.pupil');
                eyes.forEach(pupil => {
                    pupil.style.transform = `translate(0px, 0px)`; // Centro absoluto del ojo
                    pupil.style.width = "4px"; // Pupila contraída (ira)
                });
            });

            // Después de 3 segundos, se relajan
            clearTimeout(interactionTimer);
            interactionTimer = setTimeout(() => {
                document.body.classList.remove('angry-stare');
                state = 'IDLE';
                triggerEvent('gossip'); // Vuelven a chismear como si nada
            }, 3000);
        }

        // Lógica de tocar a uno (Poke)
        function pokeBicho(key) {
            lastInteractionTime = Date.now();
            resetStyles();
            
            const target = bichos[key];
            
            // Reacción física del tocado
            target.el.classList.add('shaking');
            setTimeout(() => target.el.classList.remove('shaking'), 500);

            // Reacción social de los otros
            Object.keys(bichos).forEach(k => {
                if (k !== key) {
                    // Los otros miran al que fue tocado con preocupación o juicio
                    lookAtElement(bichos[k], target.el);
                    
                    if(key === 'orange' && k === 'purple') {
                        // Si tocas al tonto, el líder se enoja contigo
                         bichos['purple'].el.style.transform = "scale(1.1)"; // Se infla
                    }
                }
            });
        }

        // --- TRACKING DE OJOS ---

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;

            // Si están enojados, te siguen con la mirada agresivamente
            if (state === 'ANGRY') {
                Object.values(bichos).forEach(b => moveEyesTo(b, mouseX, mouseY));
                return;
            }

            // Si están en 'Idle', el "tonto" (naranja) o el "tímido" (amarillo) te siguen a veces
            if (state === 'IDLE' && Math.random() > 0.9) {
                 moveEyesTo(bichos['orange'], mouseX, mouseY);
            }
        });

        function moveEyesTo(bichoObj, targetX, targetY) {
            const eyes = bichoObj.el.querySelectorAll('.eye');
            eyes.forEach(eye => {
                const rect = eye.getBoundingClientRect();
                const eyeCenterX = rect.left + rect.width / 2;
                const eyeCenterY = rect.top + rect.height / 2;
                
                const angle = Math.atan2(targetY - eyeCenterY, targetX - eyeCenterX);
                const distance = Math.min(rect.width / 4, 10); // Límite de movimiento dentro del ojo

                const pupil = eye.querySelector('.pupil');
                if(pupil) {
                    const x = Math.cos(angle) * distance;
                    const y = Math.sin(angle) * distance;
                    pupil.style.transform = `translate(${x}px, ${y}px)`;
                }
            });
        }

        function lookAtElement(observerObj, targetEl, yOffset = 0) {
            const rect = targetEl.getBoundingClientRect();
            moveEyesTo(observerObj, rect.left + rect.width/2, rect.top + rect.height/2 + yOffset);
        }

        // --- UTILIDADES ---

        function resetStyles() {
            // Limpia clases temporales
            Object.values(bichos).forEach(b => {
                b.el.classList.remove('talking', 'jumping', 'sleeping');
                b.el.style.transform = '';
                // Reset pupilas
                const pupils = b.el.querySelectorAll('.pupil');
                pupils.forEach(p => p.style.width = ''); 
            });
        }

        // --- INICIO ---
        // Arrancar el cerebro
        triggerEvent('gossip'); // Empiezan chismeando
        brainLoop();

    </script>
</body>
</html>
